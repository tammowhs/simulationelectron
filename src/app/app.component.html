<div fxLayout="row" fxLayoutAlign="start stretch" class="inherit-height">
  <div fxFlex="60" fxLayout="column" fxLayoutAlign="start stretch">

    <div #parameter fxFlex="40" class="p-16">
      <mat-card class="paramater-card">
        <mat-card-header>
          <mat-card-title>Parameter</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div fxLayout="row" fxLayoutAlign="start stretch">

            <div fxFlex=50>
              <ng-container *ngTemplateOutlet="labeledSlider; context:{name: 'Inkubationszeit', tooltip: 'Anzahl Tage, die zwischen Ansteckung und ersten Symptome vergeht. Person ist bereits ansteckend.', floor: 1, ceil: 10, step: 1, formControlName: 'daysIncubated'}">
              </ng-container>

              <ng-container *ngTemplateOutlet="labeledSlider; context:{name: 'Infektionszeit', tooltip: 'Anzahl Tage, die zwischen ersten Symptomen und Ende der Infektion vergeht. Person ist weiterhin ansteckend, hat aber eine Chance sich zu Isolieren.', floor: 1, ceil: 10, step: 1, formControlName: 'daysSymptomatic'}">
              </ng-container>

              <ng-container *ngTemplateOutlet="labeledSlider; context:{name: 'Isolationsrate', tooltip: 'Anteil aktiv Infizierter, die sich in Isolation begeben. Isolierte haben nur noch ein Zehntel der allgemeinen Ansteckungswahrscheinlichkeit.', floor: 0, ceil: 1, step: 0.05, formControlName: 'isolationRateSymptomatic'}">
              </ng-container>

              <ng-container *ngTemplateOutlet="labeledSlider; context:{name: 'Übertragungsrate', tooltip: 'Allgemeine Ansteckungswahrscheinlichkeit', floor: 0, ceil: 1, step: 0.05, formControlName: 'transmissionProbability'}">
              </ng-container>
            </div>

            <div fxFlex=50>
              <ng-container *ngTemplateOutlet="labeledSlider; context:{name: '2. Infektion', tooltip: 'Ansteckungswahrscheinlichkeit für eine Neuinfektion, nachdem man bereits erstmals geheilt war.', floor: 0, ceil: 1, step: 0.05, formControlName: 'reInfectionRate'}">
              </ng-container>

              <ng-container *ngTemplateOutlet="labeledSlider; context:{name: 'Mortalitätsrate', tooltip: 'Anteil der Infizierten, die an ihrer Erkrankung versterben.', floor: 0, ceil: 1, step: 0.01, formControlName: 'deathRate'}">
              </ng-container>

              <ng-container *ngTemplateOutlet="labeledSlider; context:{name: 'Tägliche Kontakte', tooltip: 'Anzahl der Personen, mit denen jeder Einzelne täglich Kontakt hat. Sind dies mehr als in Ihrem Bewegungsradius möglich, werden Einzelne aus letzterer Gruppe mit erhöhter Wahrscheinlichkeit infiziert.', floor: 0, ceil: 10, step: 1, formControlName: 'numberOfContacts'}">
              </ng-container>

              <ng-container *ngTemplateOutlet="labeledSlider; context:{name: 'Bewegungsradius', tooltip: 'Distamz, wie weit weg Personen reisen und sich somit gegenfalls infizieren können.', floor: 0, ceil: 10, step: 1, formControlName: 'movementRadius'}">
              </ng-container>
            </div>
          </div>

        </mat-card-content>
      </mat-card>
    </div>

    <div #statistic fxFlex="60" class="p-ex-top-16">
      <mat-card class="statistic-card">
        <mat-card-header>
          <div class="w-100" fxLayout="row" fxLayoutAlign="space-between stretch">
            <div>
              <mat-card-title>Statistik</mat-card-title>
              <mat-card-subtitle>Tag: {{day | json}}</mat-card-subtitle>
            </div>
            <div>
              <button mat-button (click)="resetStatistics()" [disabled]="!simulationEnded">Zurücksetzen</button>
            </div>
          </div>
        </mat-card-header>
        <mat-card-content class="statistic-card-content">
          <canvas baseChart class="statistic-canvas"
                  [chartType]="'line'"
                  [labels]="lineChartLabels"
                  [datasets]="lineChartData"
                  [options]="lineChartOptions"
                  [colors]="lineChartColors"
                  [legend]="true">
          </canvas>
        </mat-card-content>
      </mat-card>
    </div>
  </div>

  <div #map fxFlex="40" class="canvas-wrapper">
    <mat-card>
      <mat-card-content>
        <canvas #canvas></canvas>
      </mat-card-content>
      <mat-card-actions>
        <div fxLayout="row" fxLayoutAlign="start stretch">
          <div style="border-right: 1px solid rgb(70, 70, 70); padding-right: 16px;">
            <button mat-icon-button *ngIf="simulationEnded" (click)="reset()">
              <mat-icon matTooltip="Erneut starten">replay</mat-icon>
            </button>

            <button mat-icon-button *ngIf=" !simulationEnded && !timerRunning" (click)="toggleSimulationExecution()">
              <mat-icon matTooltip="Play">play_circle_outline</mat-icon>
            </button>

            <button mat-icon-button *ngIf="!simulationEnded && timerRunning" (click)="toggleSimulationExecution()">
              <mat-icon matTooltip="Pause">pause_circle_outline</mat-icon>
            </button>

            <button mat-icon-button (click)="simulateStep()" [disabled]="simulationEnded || timerRunning">
              <mat-icon matTooltip="Einzelner Schritt">redo</mat-icon>
            </button>
          </div>

          <div [formGroup]="metaForm" style="padding-left: 16px;">
            Geschwindigkeit {{this.metaForm.value.stepsPerSecond}}
            <mat-slider [min]="1" [max]="20" [step]="1"
                        [value]="this.metaForm.get('stepsPerSecond')!.value" (input)="this.metaForm.get('stepsPerSecond')!.setValue($event.value)">
            </mat-slider>
          </div>

        </div>

      </mat-card-actions>
    </mat-card>
  </div>
</div>

<ng-template #labeledSlider let-name="name" let-tooltip="tooltip" let-min="floor" let-max="ceil" let-step="step" let-property="formControlName">
  <div fxLayout="column" fxLayoutAlign="start stretch" class="px-16">
    <div fxLayout="row" fxLayoutAlign="space-between stretch">
      <label>
        {{name}}
        <mat-icon [matTooltip]="tooltip" [inline]="true">help_outline</mat-icon>
      </label>
      {{currentParams[property]}}
    </div>
    <mat-slider [min]="min" [max]="max" [step]="step" [(ngModel)]="currentParams[property]" (input)="currentParams[property] = $event.value"></mat-slider>
  </div>
</ng-template>
